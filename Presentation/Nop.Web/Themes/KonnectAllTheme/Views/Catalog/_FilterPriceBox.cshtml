@model PriceRangeFilterModel

<script
  asp-exclude-from-bundle="true"
  src="~/lib_npm/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"
  asp-location="Footer"
></script>

@{
    var count = Model.AvailablePriceRange.To / 5;
    var fromValue = Model.AvailablePriceRange.From;
    var toValue = count;
}
<div class="sidebar-inner Brand">
    <div class="sidebar-item accordeon-item">
        <div class="sidebar-title accordeon-title">
            <h5 class="text-left">@T("Filtering.PriceRangeFilter")</h5>
        </div>

        <ul class="sidebar-content accordeon_content show">
            @for (int i = 0; i < 5; i++)
            {
                var priceRange = @fromValue + " - " + @toValue;
                var priceRangeValue = @fromValue + "-" + @toValue;
                <li class="item">
                    <input id="attribute-price-@priceRangeValue" type="checkbox" data-price-id="@priceRangeValue" />
                    <label for="attribute-price-@priceRangeValue">
                        @priceRange
                    </label>
                </li>

                fromValue = toValue + 1;
                toValue += count;
            }
        </ul>
    </div>
</div>
<div id="price-range-slider"></div>
<script asp-location="Footer">
    $(document).ready(function () {
        var $priceRangeEl = $("#price-range-slider");
        var $psEls = $('[data-price-id]');
        $psEls.on('change', function () {
            CatalogProducts.getProducts();
        });
        var priceRange;
        var min;
        var max;
        $(CatalogProducts).on('before', function (e) {
            var selectedPrice = $.map($psEls, function (el) {
                var $pEl = $(el);
                if ($pEl.is(':checked')) { return $pEl.data('price-id'); } 
                return null;
            });
            
            if (selectedPrice && selectedPrice.length > 0) {
                for (i = 0; i < selectedPrice.length; ++i) {
                    var pr = selectedPrice[i];
                    if (i === 0) {
                        min = pr.split("-")[0];
                        max = pr.split("-")[1];
                    }
                    else { 
                        if (parseInt(pr.split("-")[0]) < min) { min = parseInt(pr.split("-")[0]); }
                        if (parseInt(pr.split("-")[1]) > max) { max = parseInt(pr.split("-")[1]); }
                    }
                }
                priceRange = min + "-" + max;
                e.payload.urlBuilder
                    .addParameter('price', priceRange);
            }
        });
    });
</script>
@* <div class="product-filter price-range-filter well">
  <div class="filter-title">
    <i class="fa fa-arrow-circle-right"></i>
    <strong>@T("Filtering.PriceRangeFilter")</strong>
  </div>
  <div class="filter-content">
    <div class="selected-price-range">
      <span class="from"></span>
      <span class="to"></span>
    </div>
    <div id="price-range-slider"></div>
    <script asp-location="Footer">
      $(document).ready(function () {
          var $priceRangeEl = $("#price-range-slider");
          $priceRangeEl.slider({
              range: true,
              min: @Model.AvailablePriceRange.From,
              max: @Model.AvailablePriceRange.To,
              values: [
            @Model.SelectedPriceRange.From,
            @Model.SelectedPriceRange.To
              ],
              slide: function (event, ui) {
                  setSelectedPriceRange(ui.values[0], ui.values[1]);
              },
              stop: function () {
                  CatalogProducts.getProducts();
              }
          });

          setSelectedPriceRange(
              $priceRangeEl.slider("values", 0),
              $priceRangeEl.slider("values", 1)
          );

          $(CatalogProducts).on('before', function (e) {
              var priceRange = $priceRangeEl.slider('values');
              if (priceRange && priceRange.length > 0) {
                  e.payload.urlBuilder
                      .addParameter('price', priceRange.join('-'));
              }
          });
      });

      function setSelectedPriceRange(from, to) {
          var $selectedPriceRangeEl = $('.selected-price-range');
          $('.from', $selectedPriceRangeEl).html(from);
          $('.to', $selectedPriceRangeEl).html(to);
      }
    </script>
  </div>
</div> *@


